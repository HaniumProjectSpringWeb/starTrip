<!DOCTYPE html>
<html lang="kr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

	<title>한이음 아이템 여행 다이어리</title>
	

    <!-- Bootstrap core CSS -->
	<link href="assets/css/bootstrap.css" rel="stylesheet">

    <!--external css-->
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <!-- Custom styles for this template -->
    <link href="assets/css/style.css" rel="stylesheet">
	<link href="assets/css/style-responsive.css" rel="stylesheet">
	
	<link href="./assets/datetime/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="./assets/datetime/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">

	<style>
		td{
			height: 4em;
		}

		td > input{
			width: 60%;
		}

		td > label{
			padding: 2%;
		}

		td > .form-control{
			width: 40%;
		}

		tr > td:first-child{
			width: 20%;
			margin: 0;
			padding: 0;
		}

		table{
			margin: 0;
			padding: 0;
			width: 100%;
		}

		#sheet_top_layout{
			display: flex;
		}
		#sheet_top_title{
			flex: 8;
		}
		#sheet_top_title h3{
			margin: 1em;
		}
		#complete_btn{
			flex: 2;
			margin: auto;
			text-align: center
		}

		#complete_btn > div:first-child{
			float: right;
			clear: both;
		}
		#main-content{
			background: #F0FFF0
		}
		#map_canvas_layout{
			display: flex;
			height: 35em;
			padding: 0%; 
		}
		#map_canvas{
			flex: 6;
			padding: 0%;
			margin: 1%;
		}
		#map_canvas_location_layout{
			padding: 0%;
			margin: 0.5em;
			flex: 4;
		}

		#map_canvas_location_list_layout{
			padding: 4%;
			height: 90%;
			margin: 0 auto;
			border: 5px double #43b1a9;
			border-radius: 0px 0px 0px 50px;
			overflow: auto;
		}

		#map_canvas_location_list_layout::-webkit-scrollbar-track
		{
			-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
			border-radius: 10px;
			background-color: #F5F5F5;
		}
		
		#map_canvas_location_list_layout::-webkit-scrollbar
		{
			width: 5px;
			background-color: #F5F5F5;
		}
		
		#map_canvas_location_list_layout::-webkit-scrollbar-thumb
		{
			border-radius: 10px;
			-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
			background-color: #43b1a9;
		}
		
		

		.placeIcon {
			width: 16px;
			height: 16px;
			margin: 2px;
		}
		#locationField {
			margin: 1%;
			padding: 0%;
		}
		#autocomplete{
			width: 50%;
		}

		#sheet_context_basicinfo_title_layout{
			margin: 3% auto;
			padding: 2%;
		}

		#sheet_context_basicinfo_title_layout > label{
			margin: 0%;
			padding: 0%; 
			float: left;
			margin-right: 2.3em;
		}

		#sheet_context_basicinfo_title_layout > input{
			margin: 0%;
			float: left;
			width: 50%
		}

		#map_canvas_for_path_layout{
			margin: 1%;
			padding: 0%;
		}


		.location_node{
			display: flex;
		}

		.node_first_layout{
			flex: 9;
			margin: 0%;
			padding: 4%;
			background-color: #FFBCB9;
			border-radius: 20px;
		}

		.node_first_layout > :first-child{
			color: #000000;
			font-weight: bold;
		}

		.node_first_layout > div:nth-child(2) > label{
			color: #000000;
			margin-right: 5em;
		}
		.node_first_layout > div:nth-child(2) > input{
			width: 40%;
			margin-bottom:5px;
			line-height:18px;
			padding:2px 5px;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
			border:1px solid #CCC;
		}
		.node_first_layout > div:nth-child(3){
			padding-top: 0.5em; 
		}
		.node_first_layout > div:nth-child(3) > label{
			color: #000000;
			margin-right: 5em;
		}
		.node_first_layout > div:nth-child(3) > input{
			width: 65%;
			margin-bottom:5px;
			line-height:18px;
			padding:2px 5px;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
			border:1px solid #CCC;
		}

		.node_first_layout > div:nth-child(4) > textarea{
			width: 100%;
			margin-bottom:5px;
			line-height:18px;
			padding:2px 5px;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
			border:1px solid #CCC;
			resize: none;
			height: 5em;
		}

		.node_first_layout > div:nth-child(5){
			text-align: center;
		}

		.node_first_layout > div:nth-child(5) > button{
			margin: 0 auto;
		}

		.node_second_layout{
			flex: 1;
			margin: 0%;
			padding: 0%;
			padding-top: 8%;
		}
		

		.input_normal_style {
			margin-bottom:5px;
			line-height:18px;
			padding:2px 5px;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
			border:1px solid #CCC;
		}

		.node_side_btn_up{
			width:2em;
			height:2em;
			background:#B4C3FF;
			color:#000000;
			border:none;
			border-right:0px;
			border-top:0px;
			border-left:0px;
			border-bottom:0px;
		}

		.node_side_btn_down{
			width:2em;
			height:2em;
			background:#B4C3FF;
			color:#000000;
			border:none;
			border-right:0px;
			border-top:0px;
			border-left:0px;
			border-bottom:0px;
		}
		.node_side_btn_x{
			width:2em;
			height:2em;
			background:#B4C3FF;
			color:#ff0000;
			border:none;
			border-right:0px; 
			border-top:0px;
			border-left:0px;
			border-bottom:0px;
		}

		.showup_distance{
			width: 100%;
			height: 3em;
			text-align: center;
			margin-top: 1em;
			margin-bottom: 1em; 
		}

		.showup_distance > div:first-child{
			margin: 0 auto;
		}

		.showup_distance > div:first-child > label{
			color: #000000;
			padding-left: 1.5em;
		}


		.arrow {display:inline-block; background:#7d1919; position:relative;}
		.arrow:after {content:''; position:absolute; width:0; height:0; border-style:solid;}
		.test_1{width:10px; height:20px;}
		.test_1:after{border-width:20px 15px;}
		.test_1:after {border-color:#7d1919 transparent transparent transparent; top:20px; left:-10px;}

		#showup_path_layout{
		}

		#map_canvas_for_path_layout{
			margin: 0% auto;
			padding: 1%;
		}

		#map_canvas_for_path{
			margin: 0%;
			padding: 0%;
			width: 100%;
			height: 30em;
		}

		.form-group > div:first-child{
			width: 50%;
		}

	</style>
  </head>

  <body>

  <section id="container" >
      <!-- **********************************************************************************************************************************************************
      TOP BAR CONTENT & NOTIFICATIONS
      *********************************************************************************************************************************************************** -->
      <!--header start-->
      <header class="header black-bg">
               <div class="sidebar-toggle-box">
                  <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
              </div>
            <!--logo start-->
            <a href="index.html" class="logo"><b>Itrip</b></a>
            <!--logo end-->
            <div class="top-menu">
              <ul class="nav pull-right top-menu">
                    <li><a class="logout" href="login.html">Logout</a></li>&emsp;
              </ul>
            </div>
            <div class="nav notify-row" id="top_menu">
                <ul class="nav top-menu">

                  <a href="#"><i class="fa fa-file-image-o fa-lg"></i></a>
                  &emsp;
                  <a href="#"><i class="fa fa-search fa-lg"></i></a>  
                  &emsp;
                  <a href="#"><i class="fa fa-info-circle fa-lg"></i></a>
                  &emsp;
            </div>
        </header>
      <!--header end-->
      
      <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
      <!--sidebar start-->
      <aside>
          <div id="sidebar"  class="nav-collapse ">
              <!-- sidebar menu start-->
              <ul class="sidebar-menu" id="nav-accordion">
                  <a href="#"><i class="fa fa-asterisk" aria-hidden="true"></i></a>
                  </br>
                  <p class="centered"><a href="profile.html"><img src="assets/img/ui-sam.jpg" class="img-circle" width="60"></a></p>
                  <h5 class="centered">스타트립</h5>
                    

                  <li class="sub-menu">
                      <a href="javascript:;" >
                      <span>여행1</span>
                      </a>
                      <ul class="sub">
                          <li><a  href="#">여행스케쥴</a></li>
                          <li><a  href="gallery.html">앨범</a></li>
                          <li><a  href="#">가계부</a></li>
                      </ul>
                  </li>
              </ul>
              <!-- sidebar menu end-->
          </div>
      </aside>
      <!--sidebar end-->






































<!-- **********************************************************************************************************************************************************
MAIN CONTENT
*********************************************************************************************************************************************************** -->
<!--main content start-->
<section id="main-content">
    <section class="wrapper" style="padding:3em">
		 <!-- page start-->
        <div id="sheet_top_layout">
			<div id="sheet_top_title">
				<h3 ><i class="fa fa-angle-right"></i> 계획 작성하기</h3>		
			</div>
			<div id="complete_btn">
				<div>
					<form>
						<button type="button" class="btn btn-success" value="완료하기" onclick="complete_event();"> 완료하기 </button>
						<button type="button" class="btn btn-theme" value="취소하기" onclick="cancle_event();"> 취소하기 </button>
					</form>
				</div>
			</div>
		</div>

		<div id="sheet_context_layout">
			<div id="sheet_context_basicinfo_layout" class="showback">
				<h5>* 간단 정보</h5>
				<div id="sheet_context_basicinfo_thema_layout">
					<table>
						<tr>
							<td>
								<label for="title">여행 범위</label>
							</td>
							<td>
								<select class="form-control" id="selcet_border";>
									<option>국내</option>
									<option>국외</option>
								</select>     
							</td>
						</tr>
						<tr>
							<td>
								<label for="title">여행 테마</label>
							</td>
							<td>
								<select class="form-control" id="select_thema";>
									<option>식도락 여행</option>
									<option>관광지 탐방</option>
									<option>쇼핑</option>
									<option>배낭 여행</option>	
									<option>감성 여행</option>
									<option>무전 여행</option>
									<option>기타 테마</option>
								</select>
							</td>
						</tr>
						<tr>
							<td>
								<label for="title">여행 주제</label>
							</td>
							<td>
								<input class="input_normal_style" type="text">
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

		<div id="sheet_context_location_search"  class="showback">
			<h5>* 장소 찾기</h5>
			<div id="locationField">
				<input id="autocomplete" class="input_normal_style" type="text" placeholder="여행 장소를 검색해주세요.">
			</div>

			<div id="map_canvas_layout">
			<div id="map_canvas" style="height:auto;width:100%;"></div>
			<div id="map_canvas_location_layout">
				<h4><i class="fa fa-angle-right"></i> 선택 장소</h4>
				<div id="map_canvas_location_list_layout">

					<!-- Node !! Part -->
					<!-- <div class="location_node">
						<div class="node_first_layout">
							<h5>Location</h6>
							<div>
								<label for="date" class="blind">도착</label>
								<input type="text" class="form_date" placeholder="0000-00-00 00:00">
							</div>
							<div>
								<label for="date" class="blind">출발</label>
								<input type="text" class="form_date" placeholder="0000-00-00 00:00">
							</div>
							<div class="textarea">
								<textarea name="memo" id="form_memo" placeholder="중요 내용을 대신 기억해드려요."></textarea>
							</div>
							<div>
								<button class="btn btn-default node_finish">내용 저장</button>
							</div>
						</div>
						<div class="node_second_layout">
							<div>
								<button class="node_side_btn_up">↑</button>
							</div>
							<div>
								<button class="node_side_btn_x">X</button>
							</div>
							<div>
								<button class="node_side_btn_down">↓</button>
							</div>
						</div>
					</div> -->
					<!-- -->
					<!-- 거리 노드 -->
					<!-- <div class="showup_distance">
						<div>
							<span class="arrow test_1"></span>
							<label>거리 : 000 km</label>
						</div>
					</div> -->
					<!--  -->

					

				</div>
			</div>
		</div>
	</div>

	
	<div id="showup_path_layout" class="showback">
		<div>
			<h5>* 경로 보기</h5>
			<h7>&nbsp;&nbsp;&nbsp;- 선택장소 > 내용저장 클릭 시 경로가 나타납니다.<sub>&nbsp;&nbsp;&nbsp;(저장 : 초록색)</sub></h7>
		</div>

		<div>
			<div id="map_canvas_for_path_layout">
				<div id="map_canvas_for_path"></div>
			</div>
		</div>

		<div id="showup_path_node">
		</div>
		
	</div>

	

	

    <!-- page end-->
	</section> <!-- /wrapper -->
</section><!-- /MAIN CONTENT -->

























      <!--main content end-->
      <!--footer start-->
      <footer>
      </footer>
      <!--footer end-->
  </section>













    <!-- js placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="assets/js/jquery.ui.touch-punch.min.js"></script>
    <script class="include" type="text/javascript" src="assets/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="assets/js/jquery.scrollTo.min.js"></script>
	<script src="assets/js/jquery.nicescroll.js" type="text/javascript"></script>

	

    <!--common script for all pages-->
	<script src="assets/js/common-scripts.js"></script>

	<!-- 맵연동하는 코드 -->
	<!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=places"></script>-->

	<script type="text/javascript" src="./assets/datetime/jquery/jquery-1.8.3.min.js" charset="UTF-8"></script>
	<script type="text/javascript" src="./assets/datetime/bootstrap-datetimepicker.js" charset="UTF-8"></script> <!-- 이부분에서 이벤트 정의 -->
	<script type="text/javascript" src="./assets/datetime/bootstrap-datetimepicker.ko.js" charset="UTF-8"></script>

	<script type="text/javascript" async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdoXf1CWYqNVCx3ylN-LEIiZULuWscoig&sensor=false&libraries=places&callback=initialize">
    </script>

	<!--맵 관련 사항 -->
	<script type="text/javascript">

		var map, places, iw;
		var mapforpath, placesforpath;
		var markers = [];	//마커 정보 모음
		var flightPath;
		var autocomplete;
		var NodePlace;
		var title;
		var thema01;
		var thema02;
		var nodeCount = 0;
		var nodeInfoArray = new Array();;

		function initialize() {
			let myLatlng = new google.maps.LatLng(37.566535, 126.97796919999996);	//초기 맵의 포커스를 위해 초기 설정
			
			let myOptions = {
				zoom: 14,
				center: myLatlng,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};
			//초기 맵 설정

			map = new google.maps.Map(document.getElementById('map_canvas'), myOptions);
			mapforpath = new google.maps.Map(document.getElementById('map_canvas_for_path'), myOptions);

			places = new google.maps.places.PlacesService(map);
			placesforpath = new google.maps.places.PlacesService(mapforpath);

			google.maps.event.addListener(map, 'tilesloaded', tilesLoaded);    // 지도에 해당 마커를 표시하는 리스터 정의 부분
			
			autocomplete = new google.maps.places.Autocomplete(document.getElementById('autocomplete'));	//이 부분이 텍스트에딧부분 설정 코드
			google.maps.event.addListener(autocomplete, 'place_changed', function () {
				showSelectedPlace();
			});
		}

		//텍스트 자동 검색
		function tilesLoaded() {
			//지도 해당 마커를 표시하는 부분
			//호출 search
			google.maps.event.clearListeners(map, 'tilesloaded');
			//google.maps.event.addListener(map, 'zoom_changed', search);
			//google.maps.event.addListener(map, 'dragend', search);
			//search();
		}

		//지도 장소 설정 부분
		function showSelectedPlace() {
			clearMarkers();

			//이부분이 로케이션 받는 부분
			var place = autocomplete.getPlace();
			//alert(place.geometry.location);

			map.panTo(place.geometry.location);
			markers[0] = new google.maps.Marker({
				position: place.geometry.location,
				map: map
			});
			/*iw = new google.maps.InfoWindow({
				content: getIWContent(place)
			});
			iw.open(map, markers[0]);*/

			google.maps.event.addListener(markers[0], 'click', getDetails(place, 0)); 

		}

		//마커 자동 추가부분
		/*function search() {
			//이부분은 네비게이션 텍스트 에딧의 자동 찾기 시스템 부분
			autocomplete.setBounds(map.getBounds());
			var search = {
				bounds: map.getBounds()
			};

			places.search(search, function (results, status) {
				if (status == google.maps.places.PlacesServiceStatus.OK) {
					clearMarkers();
					for (var i = 0; i < results.length; i++) {
						markers[i] = new google.maps.Marker({
							position: results[i].geometry.location,
							animation: google.maps.Animation.DROP
						});

						//result = place
						google.maps.event.addListener(markers[i], 'click', getDetails(results[i], i)); 

						setTimeout(dropMarker(i), i * 100);
						
					}
				}
			});
		}*/

		//맵 마커 클리어
		function clearMarkers() {
			for (var i = 0; i < markers.length; i++) {
				if (markers[i]) {
					markers[i].setMap(null);
					markers[i] == null;
				}
			}
		}

		//맵 마커 표시
		function dropMarker(i) {
			return function () {
				markers[i].setMap(map);
			}
		}

		function getDetails(result, i) {
			return function () {
				//이 부분은 마커 클릭 시에 세부정보로 넘어가는 기능을 하는부분
				//이부분을 추후 장소 div를 추가하는 부분으로 한다.

				places.getDetails({
					reference: result.reference
				}, showInfoWindow(i));
			}
		}

		function showInfoWindow(i) {
			//마커를 띄우는 부분
			return function (place, status) {
				if (iw) {
					iw.close();
					iw = null;
				}
				if (status == google.maps.places.PlacesServiceStatus.OK) {
					iw = new google.maps.InfoWindow({
						content: getIWContent(place),
					});

					iw.open(map, markers[i]);
				}
			}
		}

		function button_event(){
			if (confirm("추가하시겠습니까?") == true){    //확인
				Add_Type_BTN();
			}else{   //취소
				return;
			}
			
		}

		function complete_event(){
			if (confirm("스케줄러를 저장합니다.") == true){    //확인
				Add_Type_BTN();
			}else{   //취소
				return;
			}
			
		}

		function cancle_event(){
			if (confirm("스케줄러 작성을 취소합니다.") == true){    //확인
				location.href="showScheduler.html";
			}else{   //취소
				return;
			}
			
		}

		function Add_Type_BTN(){
			let nodeInfo = {
			location: "",
			latlng: "",
			startDay: "",
			startTime: "",
			endDay: "",
			endTime: "",
			context: "",
			mapv:"",
			tag:0
			};

			var beforeCount = nodeCount++;

			if(nodeCount >= 2 && nodeInfoArray[beforeCount-1].latlng == NodePlace.geometry.location){
				let r = confirm("연속으로 같은 곳을 기록합니다.");
				if(r == true){
					
				}else{
					nodeCount --;
					return;
				}
			}
			alert("장소가 총 " + (nodeCount) + "곳 저장되었습니다.");

			let div =document.createElement('div');
			div.className = "location_node";

			if (nodeCount > 1){
				let div2 =document.createElement('div');
				div2.className = "showup_distance";

				let first = nodeInfoArray[nodeCount-2].latlng;
				let second = NodePlace.geometry.location;
				document.getElementById('map_canvas_location_list_layout').appendChild(div2).innerHTML =
						"<div id='node_'" + nodeCount+ ">"+
							"<span class='arrow test_1'></span>"+
							"<label>거리 : " +  calculateDistance(first.lat(), first.lng(), second.lat(), second.lng())  + "km</label>"+
						"</div>";

				
			}
			nodeInfo.latlng = NodePlace.geometry.location;
			nodeInfo.mapv = map;
			nodeInfo.location = NodePlace.name;
			nodeInfoArray.push(nodeInfo);

			document.getElementById('map_canvas_location_list_layout').appendChild(div).innerHTML = 
																			"<div class='node_first_layout' id='node_first_layout_"+nodeCount+"'>"+
																				"<h5> 장소명 : "+ NodePlace.name+"</h6>"+
																				"<div class='form-group'>"+
																					"<label for='date' class='blind'>도착</label>"+
																					//"<input type='text' class='form_date form-control' placeholder='0000-00-00 00:00 [필수]'>"+
																					"<div class='input-group date form_datetime' data-date-format='yyyy-mm-dd HH:ii:p'>"+
																						"<input id='node_input_start_" + nodeCount +"' class='form-control form_date form-control' type='text' value='' placeholder='0000-00-00 00:00 [필수]' sytle='width:10em;' readonly>"+
																						"<span class='input-group-addon'><span class='glyphicon glyphicon-th'></span></span>"+
																					"</div>"+
																				"</div>"+
																				"<div class='form-group'>"+
																					"<label for='date' class='blind'>출발</label>"+
																					//"<input type='text' class='form_date form-control' placeholder='0000-00-00 00:00 [필수]'>"+
																					"<div class='input-group date form_datetime' data-date-format='yyyy-mm-dd HH:ii:p'>"+
																						"<input class='form-control form_date form-control' id='node_input_end_" + nodeCount +"' type='text' value='' placeholder='0000-00-00 00:00 [필수]' sytle='width:10em;' readonly>"+
																						"<span class='input-group-addon'><span class='glyphicon glyphicon-th'></span></span>"+
																					"</div>"+
																				"</div>"+
																				"<div class='textarea'>"+
																					"<label for='context' class='blind'>메모</label>"+
																					"<textarea name='memo' id='node_input_context_" + nodeCount +"' placeholder='중요 내용을 대신 기억해드려요. [선택]' for='context'></textarea>"+
																				"</div>"+
																				"<div>"+
																					"<button class='btn btn-default node_side_btn_store' value='" + nodeCount +"' name='store' >내용저장</button>"+
																				"</div>"+
																			"</div>"+
																			"<div class='node_second_layout'>"+
																				"<div>"+
																					"<button class='node_side_btn_up' value='" + nodeCount +"' name='up' >↑</button>"+
																				"</div>"+
																				"<div>"+
																					"<button class='node_side_btn_x' value='" + nodeCount +"' name='x' >X</button>"+
																				"</div>"+
																				"<div>"+
																					"<button class='node_side_btn_down' value='" + nodeCount +"' name='down' >↓</button>"+
																				"</div>"+
																			"</div>";
		}
				


		$(document).on("click",".node_side_btn_up",function(){ 
			let myinput = $(this).val();
			let now = myinput-1;

			if( now <= 0){
				alert("맨 처음 일정입니다.")
			}else{
				let uppernode = now -1;
				//alert("현재 노드 장소 : " + now + " 상단 노드 장소 : " + uppernode+
				//"\n현재 노드 장소 : " + nodeInfoArray[now].location + " 상단 노드 장소 : " + nodeInfoArray[uppernode].location);

				let tempOne = nodeInfoArray[now];
				let tempTwo = nodeInfoArray[uppernode];

				nodeInfoArray[now] = tempTwo;
				nodeInfoArray[uppernode] = tempOne;

				//alert("현재 노드 장소 : " + now + " 상단 노드 장소 : " + uppernode+
				//"\n현재 노드 장소 : " + nodeInfoArray[now].location + " 상단 노드 장소 : " + nodeInfoArray[uppernode].location);
				

				ReDrawListNode();
			}

		});

		$(document).on("click",".node_side_btn_x",function(){ 
			let myinput = $(this).val();
			let now = myinput-1;

			if(confirm(nodeInfoArray[now].location+"을(를) 삭제합니다.") == true){
				nodeInfoArray.splice(now, 1);
				nodeCount--;
				ReDrawListNode();
			}else{
				
			}
		});

		$(document).on("click",".node_side_btn_down",function(){ 
			let myinput = $(this).val();
			let now = myinput-1;


			if( myinput >= nodeInfoArray.length){
				alert("맨 마지막 일정입니다.")
			}else{
				let undernode = now +1;
				//alert("현재 노드 장소 : " + now + " 상단 노드 장소 : " + undernode+
				//"\n현재 노드 장소 : " + nodeInfoArray[now].location + " 상단 노드 장소 : " + nodeInfoArray[undernode].location);

				let tempOne = nodeInfoArray[now];
				let tempTwo = nodeInfoArray[undernode];

				nodeInfoArray[now] = tempTwo;
				nodeInfoArray[undernode] = tempOne;

				//alert("현재 노드 장소 : " +now + " 상단 노드 장소 : " + undernode+
				//"\n현재 노드 장소 : " + nodeInfoArray[now].location + " 상단 노드 장소 : " + nodeInfoArray[undernode].location);
				

				ReDrawListNode();
			}
		});

		$(document).on("click",".node_side_btn_store",function(){ 
			let myinput = $(this).val();

			//now is selected node in array
			let now = myinput-1;

			//let startDay = document.getElementById("node_input_start_"+myinput).val();
			let startDay = $( "#node_input_start_" + myinput ).val();
			let endDay = $( "#node_input_end_" + myinput ).val();
			let contextNode = $( "#node_input_context_" + myinput ).val();

			if(startDay === null || endDay == null || startDay === '' || endDay == ''){
				alert("필수 항목은 모두 작성하셔야합니다.");
			}else{
				let chkstart = startDay.split(' ');
				let start_day = chkstart[0].split('-');
				let start_time = chkstart[1].split(':');
				let chkend = endDay.split(' ');
				let end_day = chkend[0].split('-');
				let end_time = chkend[1].split(':');

				if(Number(start_day[0]) <= Number(end_day[0]) ||
				Number(start_day[1]) <= Number(end_day[1]) || 
				Number(start_day[2]) <= Number(end_day[2])){
					//일시별 확인

					nodeInfoArray[myinput-1].startDay = chkstart[0];
					nodeInfoArray[myinput-1].startTime = chkstart[1];
					nodeInfoArray[myinput-1].endDay = chkend[0];
					nodeInfoArray[myinput-1].endTime = chkend[1];
					nodeInfoArray[myinput-1].context = contextNode;
					nodeInfoArray[myinput-1].tag = 1;

					alert("장소 : " + nodeInfoArray[myinput-1].location + "\n" + 
						"도착일 : " + nodeInfoArray[myinput-1].startDay + "\n" +
						"도착시간 : " + nodeInfoArray[myinput-1].startTime + "\n" + 
						"출발일 : " + nodeInfoArray[myinput-1].endDay + "\n" + 
						"출발시간 : " + nodeInfoArray[myinput-1].endTime + "\n" + 
						"메모내용 : " + nodeInfoArray[myinput-1].context
					);

					let complete =document.getElementById("node_first_layout_"+(myinput));

					complete.setAttribute('style', 'background:#56B37F;');

					location_map_marker();
				}else{
					alert("도착일 및 출발일을 확인해주세요.")
				}

				
			}
			


		});

		function ReDrawListNode(){
			nodeInfoArray.forEach((item, i)=>{				
				if(i > 0){
					let div2_re =document.createElement('div');
					div2_re.className = "showup_distance";

					let first = nodeInfoArray[i-1].latlng;
					let second = nodeInfoArray[i].latlng;

					let arrow = document.getElementById('map_canvas_location_list_layout').appendChild(div2_re);
					arrow.innerHTML =
							"<div id='node_'" + i+ ">"+
								"<span class='arrow test_1'></span>"+
								"<label>거리 : " + calculateDistance(first.lat(), first.lng(), second.lat(), second.lng()) + " km</label>"+
							"</div>";
				}
				let div_re =document.createElement('div');
				div_re.className = "location_node";
				if(i == 0){document.getElementById('map_canvas_location_list_layout').innerHTML="";}
				let locationnode = document.getElementById('map_canvas_location_list_layout').appendChild(div_re);
				if(item.startDay == ''){
					locationnode.innerHTML = 
										"<div class='node_first_layout' id='node_first_layout_"+(i+1)+"'>"+
											"<h5> 장소명 : "+ item.location+"</h6>"+
											"<div class='form-group'>"+
												"<label for='date' class='blind'>도착</label>"+
												//"<input type='text' class='form_date form-control' placeholder='0000-00-00 00:00 [필수]'>"+
												"<div class='input-group date form_datetime' data-date-format='yyyy-mm-dd HH:ii:p'>"+
													"<input id='node_input_start_" + (i+1) +"' class='form-control form_date form-control' type='text' value='' placeholder='0000-00-00 00:00 [필수]' sytle='width:10em;' readonly>"+
													"<span class='input-group-addon'><span class='glyphicon glyphicon-th'></span></span>"+
												"</div>"+
											"</div>"+
											"<div class='form-group'>"+
												"<label for='date' class='blind'>출발</label>"+
												//"<input type='text' class='form_date form-control' placeholder='0000-00-00 00:00 [필수]'>"+
												"<div class='input-group date form_datetime' data-date-format='yyyy-mm-dd HH:ii:p'>"+
													"<input class='form-control form_date form-control' id='node_input_end_" + (i+1) +"' type='text' value='' placeholder='0000-00-00 00:00 [필수]' sytle='width:10em;' readonly>"+
													"<span class='input-group-addon'><span class='glyphicon glyphicon-th'></span></span>"+
												"</div>"+
											"</div>"+
											"<div class='textarea'>"+
												"<label for='context' class='blind'>메모</label>"+
												"<textarea name='memo' id='node_input_context_" + (i+1) +"' placeholder='중요 내용을 대신 기억해드려요. [선택]' for='context' value='"+ item.context +"'></textarea>"+
											"</div>"+
											"<div>"+
												"<button class='btn btn-default node_side_btn_store' value='" + (i+1) +"' name='store' >내용저장</button>"+
											"</div>"+
										"</div>"+
										"<div class='node_second_layout'>"+
											"<div>"+
												"<button class='node_side_btn_up' value='" + (i+1) +"' name='up' >↑</button>"+
											"</div>"+
											"<div>"+
												"<button class='node_side_btn_x' value='" + (i+1) +"' name='x' >X</button>"+
											"</div>"+
											"<div>"+
												"<button class='node_side_btn_down' value='" + (i+1) +"' name='down' >↓</button>"+
											"</div>"+
										"</div>";
				}else{
					locationnode.innerHTML = 
										"<div class='node_first_layout' id='node_first_layout_"+(i+1)+"'>"+
											"<h5> 장소명 : "+ item.location+"</h6>"+
											"<div class='form-group'>"+
												"<label for='date' class='blind'>도착</label>"+
												//"<input type='text' class='form_date form-control' placeholder='0000-00-00 00:00 [필수]'>"+
												"<div class='input-group date form_datetime' data-date-format='yyyy-mm-dd HH:ii:p'>"+
													"<input id='node_input_start_" + (i+1) +"' class='form-control form_date form-control' type='text' value='"+ item.startDay+" " + item.startTime +"' placeholder='0000-00-00 00:00 [필수]' sytle='width:10em;' readonly>"+
													"<span class='input-group-addon'><span class='glyphicon glyphicon-th'></span></span>"+
												"</div>"+
											"</div>"+
											"<div class='form-group'>"+
												"<label for='date' class='blind'>출발</label>"+
												//"<input type='text' class='form_date form-control' placeholder='0000-00-00 00:00 [필수]'>"+
												"<div class='input-group date form_datetime' data-date-format='yyyy-mm-dd HH:ii:p'>"+
													"<input class='form-control form_date form-control' id='node_input_end_" + (i+1) +"' type='text' value='"+ item.endDay+" " + item.endTime +"' placeholder='0000-00-00 00:00 [필수]' sytle='width:10em;' readonly>"+
													"<span class='input-group-addon'><span class='glyphicon glyphicon-th'></span></span>"+
												"</div>"+
											"</div>"+
											"<div class='textarea'>"+
												"<label for='context' class='blind'>메모</label>"+
												"<textarea name='memo' id='node_input_context_" + (i+1) +"' placeholder='중요 내용을 대신 기억해드려요. [선택]' for='context' value='"+ item.context +"'></textarea>"+
											"</div>"+
											"<div>"+
												"<button class='btn btn-default node_side_btn_store' value='" + (i+1) +"' name='store' >내용저장</button>"+
											"</div>"+
										"</div>"+
										"<div class='node_second_layout'>"+
											"<div>"+
												"<button class='node_side_btn_up' value='" + (i+1) +"' name='up' >↑</button>"+
											"</div>"+
											"<div>"+
												"<button class='node_side_btn_x' value='" + (i+1) +"' name='x' >X</button>"+
											"</div>"+
											"<div>"+
												"<button class='node_side_btn_down' value='" + (i+1) +"' name='down' >↓</button>"+
											"</div>"+
										"</div>";
				}

				if(item.tag == 1){
					let complete =document.getElementById("node_first_layout_"+(i+1));
					complete.setAttribute('style', 'background:#56B37F;');
				}
				
			});

			location_map_marker();

		}

		function getIWContent(temp) {
			NodePlace = temp;
			//이부분이 클릭 이벤트가 들어가는 부분이다.!!
			let content = '<table style="border:0"><tr><td style="border:0;">';
			content += '<img class="placeIcon" src="' + temp.icon + '"></td>';
			content += '<td style="border:0;"><b>'+temp.name+'</b>';
			content += '</td></tr></table>';
			content += "<input class='btn btn-round btn-success' type='button' value='추가하기' onclick='button_event();'>";
			return content;
		}

		// 위도 경도 거리 계산 공식, 소수점 2자리 반올림
		function calculateDistance(lat1, lon1, lat2, lon2) {
			var R = 6371; // km
			var dLat = (lat2-lat1).toRad();
			var dLon = (lon2-lon1).toRad(); 
			var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
					Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * 
					Math.sin(dLon/2) * Math.sin(dLon/2); 
			var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
			var d = R * c;
			return d.toFixed(2);
		}
		Number.prototype.toRad = function() {
			return this * Math.PI / 180;
		}

		$(document).on("click",".form_datetime",function(){ 
			$(this).datetimepicker({
				weekStart: 1,
				todayBtn:  1,
				autoclose: 1,
				todayHighlight: 1,
				startView: 2,
				forceParse: 0,
				showMeridian: 1
			});
		});

		function location_map_marker(){
			let flightPlanCoordinates =[];

			for(var j = 0; j < nodeInfoArray.length; j++){
				if(nodeInfoArray[j].tag ==1){
					//작성완성시
					//first.lat(), first.lng()
					flightPlanCoordinates.push({
						lat : nodeInfoArray[j].latlng.lat(),
						lng : nodeInfoArray[j].latlng.lng(),
						position: nodeInfoArray[j].latlng,
						icons : [{ //방향을 알기 위한 화살표 표시
								icon : {path : google.maps.SymbolPath.BACKWARD_CLOSED_ARROW}
								, offset  : '100%'
								, repeat : '100px'
									}],
						title: nodeInfoArray[j].location,
						map: nodeInfoArray[j].map
					});

				}
			}

			if(flightPlanCoordinates.length >= 2){
				flightPath.setMap(null);
			}


			flightPath = new google.maps.Polyline({
				path: flightPlanCoordinates,
				geodesic: true,
				strokeColor: '#FF0000',
				strokeOpacity: 1.0,
				strokeWeight: 8
			});
			

			//markers_path.setMap(mapforpath);
			flightPath.setMap(mapforpath);
			mapforpath.setCenter(flightPlanCoordinates[flightPlanCoordinates.length-1].position);
			
		}


		//해당 완료 시 맵을 로드한다.
		//google.maps.event.addDomListener(window, 'load', initialize);

	</script>
	
  </body>
</html>
